# 開発作業依頼書

## 作業ガイドライン

- 可能な限り TDD で進める
  - リファクタリングや機能追加よりも先に適切なテストがあることを確認、ない場合にはテストを書く
  - 既存コードベースでテストが不足していると感じたらテストカバレッジを向上させる
- ドキュメント重要
  - 現に動いている実装を真として ADR を更新すること
- ビルドエラー・コンパイルエラー・型エラーについて
  - Error は必ず解決する
  - Warnings は可能な限り解決する
- エラーが無く、テストが通った場合には、ユーザーの意思決定や確認や許可や承認は不要で自分の判断で commit & push してよい
  - 適切なコミットメッセージを英語で書く
  - 大きめの変更を加える前には作業をロールバックできるように必ずコミットしておくべき
- 自律的かつ継続的に作業を続行する
  - ユーザーの意思決定や確認や許可や承認や操作がどうしても絶対的に必要だと判断した場合以外は自律的に作業を進めてよい
  - ユーザーの意思決定や確認や許可や承認や操作が必要だと判断した場合には、必ず作業を一時停止し、 ntfy スキルでユーザーを呼び出して待機する
    - 何をしてほしいのか要点を漏らさず簡潔に日本語で依頼すること
  - 以下の各タスクが完了したら ntfy で通知だけして次のタスクに着手してよい
- amem を最大限活用する
  - amem はコーディングAIエージェントが長期間・長時間に渡って自律的かつ継続的に作業をするための重要なツール
  - 自分の作業・活動の進捗について amem を使って適切に記録しておくこと

## タスク概要

優先順で書かれているので順番に作業すること。

- repos/yuiclaw の開発続行
  - repos/acomm の TUI を拡張する
    - repos/_tui に clone されている git リポジトリのTUI実装を調査
      - 調査対象: claude-code (React+Yoga WASM), codex (Ratatui/Rust), gemini-cli (Ink/React), opencode (Solid.js+@opentui)
      - 共通点を整理
        - 4つ全てが共通して実装している機能
          - Markdown レンダリング（ヘッダー・コードブロック・リスト・表）
          - コードブロックの Syntax Highlighting
          - 処理中スピナー / ローディングアニメーション
          - スクロール可能なメッセージ履歴
          - スラッシュコマンド体系（/help, /clear, /model など）
          - テーマ / カラーカスタマイズ（ダーク/ライト自動検出を含む）
          - セッション履歴の保存・参照
        - 共通点のうち acomm TUI に不足している項目を列挙
          - [ ] **Markdown レンダリング**: メッセージ本文のマークダウンを整形表示する（現状は生テキスト表示のみ）
          - [ ] **Syntax Highlighting**: コードブロック内のシンタックスカラーリング（言語識別付き）
          - [ ] **スラッシュコマンド autocomplete**: 入力中に候補ドロップダウンを表示する（現状は補完なし）
          - [ ] **セッション履歴ブラウザ**: 過去セッションを一覧・検索・選択して再開できる `/session` または `/resume` コマンド
          - [ ] **仮想スクロール (VirtualizedList)**: 長い会話履歴を効率的に描画するための仮想化リスト
          - [ ] **テーマシステム**: ダーク/ライト自動検出 + `/theme` コマンドによる切り替え
      - 相違点を整理
        - 各ツール固有の特徴的な機能
          - claude-code: `@` ファイルメンション + .gitignore 対応オートコンプリート、プランモード (`/plan`)、Thinking blocks の折りたたみ表示、外部エディタ起動 (Ctrl+G)、プロンプトスタッシュ (Ctrl+S)
          - codex: シマーアニメーション（ストリーミングテキストへの時間ベース光沢エフェクト、RGB ブレンド）、32種類 Syntax Highlighting テーマ (Dracula/Nord/Gruvbox/Catppuccin 等 syntect)、承認ダイアログ overlay、セッション JSON ログ
          - gemini-cli: Google カラー 6色グラデーションスピナー、RewindViewer（会話履歴の任意の時点へ巻き戻し・フォーク）、バックグラウンドシェル統合 (Ctrl+B/L/K)、セッションブラウザ（ページネーション・検索・日付/件数ソート）
          - opencode: コマンドパレット (Ctrl+P, fuzzy search)、セッション分岐/タイムラインナビゲーション、Knight Rider スキャナースピナー（光がバウンス+トレイル+ブルーム）、コスト/トークン使用量表示、セッション Markdown エクスポート、プロンプトスタッシュ複数件管理
        - 相違点のうち acomm TUI に取り込む価値のありそうな項目を列挙
          - [ ] **コスト/トークン使用量表示** (opencode 由来): ステータスバーにコンテキスト使用率 (%) や概算コスト (USD) をリアルタイム表示する
          - [ ] **バックグラウンドシェル統合** (gemini-cli 由来): Ctrl+B/L/K でシェルコマンドをバックグラウンド実行し、結果を会話に取り込む
          - [ ] **シマーアニメーション** (codex 由来): ストリーミング中のテキストに時間ベースの光沢エフェクトを重ねて「生成中」感を演出する
          - [ ] **コマンドパレット** (opencode 由来): Ctrl+P でフルスクリーンの fuzzy search コマンドパレットを開き、全スラッシュコマンドをキーボードで素早く選べるようにする
          - [ ] **RewindViewer / セッション分岐** (gemini-cli + opencode 由来): 会話履歴の任意の時点を選択して「ここから別の会話を始める」フォーク機能
          - [ ] **`@` ファイルメンション** (claude-code 由来): `@` を入力すると gitignore 対応のファイル候補をオートコンプリートし、ファイルパスを prompt に挿入する
          - [ ] **セッション Markdown エクスポート** (opencode 由来): 現在の会話を Markdown ファイルに書き出す `/export` コマンド
          - [ ] **プロンプトスタッシュ** (claude-code + opencode 由来): Ctrl+S で入力中の長いプロンプトを一時保存し、後で呼び出せるスタッシュ機能
